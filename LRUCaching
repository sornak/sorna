import { createClient } from 'redis';

// Create a Redis client
const redisClient = createClient();

// Handle Redis connection
redisClient.on('connect', () => {
  console.log('Connected to Redis');
});
redisClient.on('error', (err) => {
  console.error('Redis error:', err);
});

// Function to set a cache value
const setCache = async (key, value, ttlInSeconds) => {
  try {
    await redisClient.setEx(key, ttlInSeconds, JSON.stringify(value));
    console.log(`Key "${key}" cached with TTL of ${ttlInSeconds} seconds`);
  } catch (err) {
    console.error('Error setting cache:', err);
  }
};

// Function to get a cached value
const getCache = async (key) => {
  try {
    const cachedData = await redisClient.get(key);
    return cachedData ? JSON.parse(cachedData) : null;
  } catch (err) {
    console.error('Error getting cache:', err);
    return null;
  }
};

// Example usage
(async () => {
  // Connect to Redis
  await redisClient.connect();

  await setCache('user1', { name: 'Sam', age: 40 }, 300);

  const cachedUser = await getCache('user1');
  console.log('Cached User:', cachedUser);

  await redisClient.quit();
})();
